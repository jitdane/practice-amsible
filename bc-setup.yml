---
- name: create bootcamp environment
  hosts:
  - bootcamp
  become: true
  gather_facts: false
  tasks:
  - name: add /etc/profile.d/{{ mach_mode }}.sh
    template:
      src: "templates/env.j2"
      dest: "/etc/profile.d/{{ mach_mode }}.sh"
      mode: 0644
  - name: mkdir /tmp/reports
    file:
      path: /tmp/reports
      state: directory
  - name: add users
    user:
      name: "{{ item }}"
    with_items: "{{ usernames }}"
  - name: create authorized_keys
    authorized_key:
      user: "{{ item }}"
      key: "{{ lookup('file', 'files/' + item + '_key.pub') }}"
      manage_dir: yes
    with_items: "{{ usernames }}"
  - name: assign passwords
    shell: "cat {{ playbook_dir }}/files/{{ item }}.pass | passwd --stdin {{ item }}" 
    with_items: "{{ usernames }}"
